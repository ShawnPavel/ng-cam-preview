"use strict";
var core_1 = require("@angular/core");
var application = require("application");
if (application.android) {
    var STATE_PREVIEW = 0;
    var STATE_WAITING_LOCK = 1;
    var STATE_WAITING_PRECAPTURE = 2;
    var STATE_WAITING_NON_PRECAPTURE = 3;
    var STATE_PICTURE_TAKEN = 4;
    var mState = STATE_PREVIEW;
    var mTextureView;
    var mPreviewSize = null;
    var mCameraDevice = null;
    var mPreviewBuilder = null;
    var mPreviewSession = null;
    var mStateCallback = null;
    var mPreviewStateCallback = null;
}
var mSurfaceTextureListener;
var MyStateCallback;
var MyPreviewStateCallback;
var AndroidCameraPreviewComponent = AndroidCameraPreviewComponent_1 = (function () {
    function AndroidCameraPreviewComponent() {
    }
    AndroidCameraPreviewComponent.prototype.ngOnInit = function () {
        AndroidCameraPreviewComponent_1.requestPermissions();
    };
    AndroidCameraPreviewComponent.prototype.takePhoto = function () {
        captureImage();
    };
    // Init
    AndroidCameraPreviewComponent.prototype.onCreatingView = function (args) {
        mTextureView = new android.view.TextureView(application.android.context);
        mTextureView.setSurfaceTextureListener(mSurfaceTextureListener);
        args.view = mTextureView;
    };
    /* Static Methods */
    AndroidCameraPreviewComponent.isAvailable = function () {
        var utils = require("utils/utils");
        return utils.ad.getApplicationContext().getPackageManager().hasSystemFeature(android.content.pm.PackageManager.FEATURE_CAMERA);
    };
    AndroidCameraPreviewComponent.requestPermissions = function () {
        var REQUEST_REQUIRED_PERMISSIONS = 1234;
        if (!AndroidCameraPreviewComponent_1.hasPermissions()) {
            android.support.v4.app.ActivityCompat.requestPermissions(application.android.currentContext, [android.Manifest.permission.CAMERA, android.Manifest.permission.WRITE_EXTERNAL_STORAGE], REQUEST_REQUIRED_PERMISSIONS);
        }
    };
    AndroidCameraPreviewComponent.hasPermissions = function () {
        console.log("checking permissions ....");
        return android.support.v4.content.ContextCompat.checkSelfPermission(application.android.currentContext, android.Manifest.permission.WRITE_EXTERNAL_STORAGE) === android.content.pm.PackageManager.PERMISSION_GRANTED
            && android.support.v4.content.ContextCompat.checkSelfPermission(application.android.currentContext, android.Manifest.permission.CAMERA) === android.content.pm.PackageManager.PERMISSION_GRANTED;
    };
    return AndroidCameraPreviewComponent;
}());
AndroidCameraPreviewComponent.TAG = 'NNGCameraPreview';
AndroidCameraPreviewComponent = AndroidCameraPreviewComponent_1 = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'android-camera-preview',
        templateUrl: 'android-camera-preview.component.html',
        styleUrls: ['android-camera-preview.css']
    }),
    __metadata("design:paramtypes", [])
], AndroidCameraPreviewComponent);
exports.AndroidCameraPreviewComponent = AndroidCameraPreviewComponent;
function startPreview() {
    var texture = mTextureView.getSurfaceTexture();
    if (texture == null) {
        return;
    }
    texture.setDefaultBufferSize(mPreviewSize.getWidth(), mPreviewSize.getHeight());
    var surface = new android.view.Surface(texture);
    try {
        mPreviewBuilder = mCameraDevice.createCaptureRequest(android.hardware.camera2.CameraDevice.TEMPLATE_PREVIEW);
    }
    catch (err) {
        console.error(err);
    }
    mPreviewBuilder.addTarget(surface);
    try {
        if (mPreviewStateCallback == null) {
            mPreviewStateCallback = new MyPreviewStateCallback();
        }
        var surfaceList = new java.util.ArrayList();
        surfaceList.add(surface);
        mCameraDevice.createCaptureSession(surfaceList, mPreviewStateCallback, null);
    }
    catch (err) {
        console.error(err);
    }
}
if (application.android) {
    /* Listeners */
    mSurfaceTextureListener = new android.view.TextureView.SurfaceTextureListener({
        onSurfaceTextureAvailable: function (surface, width, height) {
            console.log('SurfaceTextureListener onSurfaceTextureAvailable');
            var appContext = application.android.foregroundActivity;
            var manager = appContext.getSystemService(android.content.Context.CAMERA_SERVICE);
            try {
                var cameraId = manager.getCameraIdList()[0]; // TODO: find the back facing camera
                var characteristics = manager.getCameraCharacteristics(cameraId);
                var map = characteristics.get(android.hardware.camera2.CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);
                mPreviewSize = map.getOutputSizes(android.graphics.SurfaceTexture.class)[0];
                if (mStateCallback == null) {
                    mStateCallback = new MyStateCallback();
                }
                manager.openCamera(cameraId, mStateCallback, null);
            }
            catch (err) {
                console.error(err);
            }
        },
        onSurfaceTextureUpdated: function (surface) {
            // console.log('SurfaceTextureListener onSurfaceTextureUpdated');
        },
        onSurfaceTextureSizeChanged: function (surface, width, height) {
            console.log('SurfaceTextureListener onSurfaceTextureSizeChanged');
        },
        onSurfaceTextureDestroyed: function (surface) {
            console.log('SurfaceTextureListener onSurfaceTextureDestroyed');
            return false;
        }
    });
    /* Callbacks */
    MyStateCallback = android.hardware.camera2.CameraDevice.StateCallback.extend({
        onOpened: function (camera) {
            console.log('CameraDevice.StateCallback onOpened');
            mCameraDevice = camera;
            startPreview();
        },
        onError: function (camera, error) {
            console.error('CameraDevice.StateCallbackError: ' + error);
        },
        onDisconnected: function (camera) {
            console.log('CameraDevice.StateCallback onDisconnected');
        }
    });
    MyPreviewStateCallback = android.hardware.camera2.CameraCaptureSession.StateCallback.extend({
        onConfigured: function (session) {
            console.log('CameraCaptureSession.StateCallback onConfigured');
            mPreviewSession = session;
            mPreviewBuilder.set(android.hardware.camera2.CaptureRequest.CONTROL_MODE, java.lang.Integer.valueOf(android.hardware.camera2.CameraMetadata.CONTROL_MODE_AUTO));
            var backgroundThread = new android.os.HandlerThread('NNGCameraPreview');
            backgroundThread.start();
            var backgroundHandler = new android.os.Handler(backgroundThread.getLooper());
            try {
                mPreviewSession.setRepeatingRequest(mPreviewBuilder.build(), null, backgroundHandler);
            }
            catch (err) {
                console.error(err);
            }
        },
        onConfigureFailed: function (session) {
            console.log('CameraCaptureSession Configure failed');
        }
    });
}
/* IMAGE CAPTURE */
function captureImage() {
    if (null == mCameraDevice) {
        return;
    }
    var appContext = application.android.foregroundActivity;
    var manager = appContext.getSystemService(android.content.Context.CAMERA_SERVICE);
    try {
        var characteristics = manager.getCameraCharacteristics(mCameraDevice.getId());
        var jpegSizes = null;
        if (characteristics != null) {
            jpegSizes = characteristics
                .get(android.hardware.camera2.CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP)
                .getOutputSizes(android.graphics.ImageFormat.JPEG);
        }
        var width = 640; // default
        var height = 480; // default
        if (jpegSizes != null && jpegSizes.length > 0) {
            width = jpegSizes[0].getWidth();
            height = jpegSizes[0].getHeight();
        }
        var reader = android.media.ImageReader.newInstance(width, height, android.graphics.ImageFormat.JPEG, 1);
        var outputSurfaces = new java.util.ArrayList();
        outputSurfaces.add(reader.getSurface());
        outputSurfaces.add(new android.view.Surface(mTextureView.getSurfaceTexture()));
        var captureBuilder_1 = mCameraDevice.createCaptureRequest(android.hardware.camera2.CameraDevice.TEMPLATE_STILL_CAPTURE);
        captureBuilder_1.addTarget(reader.getSurface());
        captureBuilder_1.set(android.hardware.camera2.CaptureRequest.CONTROL_MODE, java.lang.Integer.valueOf(android.hardware.camera2.CameraMetadata.CONTROL_MODE_AUTO));
        // TODO: rotation
        // let rotation = appContext.getWindowManager().getDefaultDisplay().getRotation();
        // captureBuilder.set(android.hardware.camera2.CaptureRequest.JPEG_ORIENTATION, java.lang.Integer.valueOf(getRotation(rotation)));
        var file_1 = new java.io.File(android.os.Environment.getExternalStorageDirectory() + "/DCIM", "pic" + (Math.floor(Math.random() * 9999) + 1) + ".jpg");
        var readerListener = new android.media.ImageReader.OnImageAvailableListener({
            save: function (bytes) {
                console.log('Saving Bytes');
                var output = null;
                try {
                    output = new java.io.FileOutputStream(file_1);
                    output.write(bytes);
                }
                finally {
                    if (output != null) {
                        output.close();
                    }
                }
            },
            onImageAvailable: function (reader) {
                var image = null;
                try {
                    image = reader.acquireLatestImage();
                    var buffer = image.getPlanes()[0].getBuffer();
                    var bytes = Array.create('byte', buffer.capacity());
                    buffer.get(bytes);
                    this.save(bytes);
                }
                catch (err) {
                    console.error(err);
                }
                finally {
                    if (image != null) {
                        image.close();
                    }
                }
            }
        });
        var thread = new android.os.HandlerThread('NNGCameraPreview');
        thread.start();
        var backgroundHandler_1 = new android.os.Handler(thread.getLooper());
        reader.setOnImageAvailableListener(readerListener, backgroundHandler_1);
        var captureListener_1 = android.hardware.camera2.CameraCaptureSession.CaptureCallback.extend({
            onCaptureCompleted: function (session, request, result) {
                startPreview();
                console.log('Capture Complete');
            }
        });
        var captureStateCallback = android.hardware.camera2.CameraCaptureSession.StateCallback.extend({
            onConfigured: function (session) {
                try {
                    session.capture(captureBuilder_1.build(), new captureListener_1(), backgroundHandler_1);
                }
                catch (err) {
                    console.error(err);
                }
            },
            onConfigureFailed: function (session) {
            }
        });
        mCameraDevice.createCaptureSession(outputSurfaces, new captureStateCallback(), backgroundHandler_1);
    }
    catch (err) {
        console.error(err);
    }
}
function getRotation(rotation) {
    if (rotation === android.view.Surface.ROTATION_0) {
        return 90;
    }
    else if (rotation === android.view.Surface.ROTATION_90) {
        return 0;
    }
    else if (rotation === android.view.Surface.ROTATION_180) {
        return 270;
    }
    else {
        return 180;
    }
}
var AndroidCameraPreviewComponent_1;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5kcm9pZC1jYW1lcmEtcHJldmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhbmRyb2lkLWNhbWVyYS1wcmV2aWV3LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQWtEO0FBRWxELHlDQUEyQztBQU8zQyxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUV6QixJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUM7SUFDdEIsSUFBSSxrQkFBa0IsR0FBRyxDQUFDLENBQUM7SUFDM0IsSUFBSSx3QkFBd0IsR0FBRyxDQUFDLENBQUM7SUFDakMsSUFBSSw0QkFBNEIsR0FBRyxDQUFDLENBQUM7SUFDckMsSUFBSSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7SUFDNUIsSUFBSSxNQUFNLEdBQUcsYUFBYSxDQUFDO0lBRTNCLElBQUksWUFBaUIsQ0FBQztJQUN0QixJQUFJLFlBQVksR0FBUSxJQUFJLENBQUM7SUFDN0IsSUFBSSxhQUFhLEdBQVEsSUFBSSxDQUFDO0lBQzlCLElBQUksZUFBZSxHQUFRLElBQUksQ0FBQztJQUNoQyxJQUFJLGVBQWUsR0FBUSxJQUFJLENBQUM7SUFFaEMsSUFBSSxjQUFjLEdBQVEsSUFBSSxDQUFDO0lBQy9CLElBQUkscUJBQXFCLEdBQVEsSUFBSSxDQUFDO0FBQ3ZDLENBQUM7QUFDRCxJQUFJLHVCQUF1QixDQUFDO0FBQzVCLElBQUksZUFBZSxDQUFDO0FBQ3BCLElBQUksc0JBQXNCLENBQUM7QUFRM0IsSUFBYSw2QkFBNkI7SUFJekM7SUFDQSxDQUFDO0lBRUQsZ0RBQVEsR0FBUjtRQUNDLCtCQUE2QixDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDcEQsQ0FBQztJQUVNLGlEQUFTLEdBQWhCO1FBQ0MsWUFBWSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVELE9BQU87SUFDQyxzREFBYyxHQUF0QixVQUF1QixJQUFJO1FBQzFCLFlBQVksR0FBRyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDekUsWUFBWSxDQUFDLHlCQUF5QixDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUM7SUFDMUIsQ0FBQztJQUVELG9CQUFvQjtJQUNOLHlDQUFXLEdBQXpCO1FBQ0MsSUFBSSxLQUFLLEdBQXVCLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUV2RCxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0lBQy9ILENBQUM7SUFFYSxnREFBa0IsR0FBaEM7UUFDQyxJQUFJLDRCQUE0QixHQUFHLElBQUksQ0FBQztRQUN4QyxFQUFFLENBQUMsQ0FBQyxDQUFDLCtCQUE2QixDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMvQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsY0FBZSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLENBQU8sT0FBUSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFRLE9BQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDLEVBQUUsNEJBQTRCLENBQUMsQ0FBQztRQUMzTyxDQUFDO0lBQ0YsQ0FBQztJQUVhLDRDQUFjLEdBQTVCO1FBQ0MsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYyxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFRLE9BQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDLEtBQUssT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLGtCQUFrQjtlQUN4TixPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYyxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFRLE9BQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQztJQUNqTixDQUFDO0lBQ0Ysb0NBQUM7QUFBRCxDQUFDLEFBekNELElBeUNDO0FBdkNlLGlDQUFHLEdBQUcsa0JBQWtCLENBQUM7QUFGNUIsNkJBQTZCO0lBTnpDLGdCQUFTLENBQUM7UUFDVixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDbkIsUUFBUSxFQUFFLHdCQUF3QjtRQUNsQyxXQUFXLEVBQUUsdUNBQXVDO1FBQ3BELFNBQVMsRUFBRSxDQUFDLDRCQUE0QixDQUFDO0tBQ3pDLENBQUM7O0dBQ1csNkJBQTZCLENBeUN6QztBQXpDWSxzRUFBNkI7QUEyQzFDO0lBRUMsSUFBSSxPQUFPLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDL0MsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDckIsTUFBTSxDQUFDO0lBQ1IsQ0FBQztJQUVELE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLEVBQUUsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDaEYsSUFBSSxPQUFPLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVoRCxJQUFJLENBQUM7UUFDSixlQUFlLEdBQUcsYUFBYSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzlHLENBQUM7SUFBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBRUQsZUFBZSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNuQyxJQUFJLENBQUM7UUFDSixFQUFFLENBQUMsQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ25DLHFCQUFxQixHQUFHLElBQUksc0JBQXNCLEVBQUUsQ0FBQztRQUN0RCxDQUFDO1FBQ0QsSUFBSSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzVDLFdBQVcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFekIsYUFBYSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5RSxDQUFDO0lBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztBQUNGLENBQUM7QUFFRCxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUN6QixlQUFlO0lBQ2YsdUJBQXVCLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQztRQUM3RSx5QkFBeUIsWUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU07WUFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1lBQ2hFLElBQUksVUFBVSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7WUFDeEQsSUFBSSxPQUFPLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ2xGLElBQUksQ0FBQztnQkFDSixJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxvQ0FBb0M7Z0JBQ2pGLElBQUksZUFBZSxHQUFHLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDakUsSUFBSSxHQUFHLEdBQUcsZUFBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO2dCQUM5RyxZQUFZLEdBQUcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFNUUsRUFBRSxDQUFDLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQzVCLGNBQWMsR0FBRyxJQUFJLGVBQWUsRUFBRSxDQUFDO2dCQUN4QyxDQUFDO2dCQUVELE9BQU8sQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNwRCxDQUFDO1lBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLENBQUM7UUFDRixDQUFDO1FBQ0QsdUJBQXVCLFlBQUMsT0FBTztZQUM5QixpRUFBaUU7UUFDbEUsQ0FBQztRQUNELDJCQUEyQixZQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTTtZQUNqRCxPQUFPLENBQUMsR0FBRyxDQUFDLG9EQUFvRCxDQUFDLENBQUM7UUFDbkUsQ0FBQztRQUNELHlCQUF5QixZQUFDLE9BQU87WUFDaEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDZCxDQUFDO0tBQ0QsQ0FBQyxDQUFDO0lBR0gsZUFBZTtJQUNmLGVBQWUsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUM1RSxRQUFRLFlBQUMsTUFBTTtZQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMscUNBQXFDLENBQUMsQ0FBQztZQUNuRCxhQUFhLEdBQUcsTUFBTSxDQUFDO1lBQ3ZCLFlBQVksRUFBRSxDQUFDO1FBQ2hCLENBQUM7UUFDRCxPQUFPLFlBQUMsTUFBTSxFQUFFLEtBQUs7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUM1RCxDQUFDO1FBQ0QsY0FBYyxZQUFDLE1BQU07WUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO1FBQzFELENBQUM7S0FDRCxDQUFDLENBQUM7SUFFSCxzQkFBc0IsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDO1FBQzNGLFlBQVksWUFBQyxPQUFPO1lBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsaURBQWlELENBQUMsQ0FBQztZQUMvRCxlQUFlLEdBQUcsT0FBTyxDQUFDO1lBRTFCLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLFlBQVksRUFDdkUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7WUFFdkYsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDeEUsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDekIsSUFBSSxpQkFBaUIsR0FBRyxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFFN0UsSUFBSSxDQUFDO2dCQUNKLGVBQWUsQ0FBQyxtQkFBbUIsQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixDQUFDLENBQUM7WUFDdkYsQ0FBQztZQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwQixDQUFDO1FBQ0YsQ0FBQztRQUNELGlCQUFpQixZQUFDLE9BQU87WUFDeEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1FBQ3RELENBQUM7S0FDRCxDQUFDLENBQUM7QUFHSixDQUFDO0FBR0EsbUJBQW1CO0FBQ25CO0lBQ0MsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDM0IsTUFBTSxDQUFDO0lBQ1IsQ0FBQztJQUNELElBQUksVUFBVSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7SUFDeEQsSUFBSSxPQUFPLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ2xGLElBQUksQ0FBQztRQUNKLElBQUksZUFBZSxHQUFHLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUU5RSxJQUFJLFNBQVMsR0FBUSxJQUFJLENBQUM7UUFDMUIsRUFBRSxDQUFDLENBQUMsZUFBZSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDN0IsU0FBUyxHQUFHLGVBQWU7aUJBQ3pCLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQywrQkFBK0IsQ0FBQztpQkFDbkYsY0FBYyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFDRCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQyxVQUFVO1FBQzNCLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLFVBQVU7UUFDNUIsRUFBRSxDQUFDLENBQUMsU0FBUyxJQUFJLElBQUksSUFBSSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNoQyxNQUFNLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ25DLENBQUM7UUFFRCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDeEcsSUFBSSxjQUFjLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQy9DLGNBQWMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFDeEMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUvRSxJQUFJLGdCQUFjLEdBQUcsYUFBYSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ3RILGdCQUFjLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1FBQzlDLGdCQUFjLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQ3RFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1FBRXZGLGlCQUFpQjtRQUNqQixrRkFBa0Y7UUFDbEYsa0lBQWtJO1FBRWxJLElBQUksTUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxPQUFPLEVBQUUsS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDckosSUFBSSxjQUFjLEdBQUcsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyx3QkFBd0IsQ0FBQztZQUMzRSxJQUFJLFlBQUMsS0FBSztnQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUM1QixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7Z0JBQ2xCLElBQUksQ0FBQztvQkFDSixNQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGdCQUFnQixDQUFDLE1BQUksQ0FBQyxDQUFDO29CQUM1QyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNyQixDQUFDO3dCQUFTLENBQUM7b0JBQ1YsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7d0JBQ3BCLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDaEIsQ0FBQztnQkFDRixDQUFDO1lBQ0YsQ0FBQztZQUNELGdCQUFnQixZQUFDLE1BQU07Z0JBQ3RCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQztnQkFDakIsSUFBSSxDQUFDO29CQUNKLEtBQUssR0FBRyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztvQkFDcEMsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDO29CQUM5QyxJQUFJLEtBQUssR0FBUyxLQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztvQkFDM0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbEIsQ0FBQztnQkFBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLENBQUM7d0JBQVMsQ0FBQztvQkFDVixFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQzt3QkFDbkIsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO29CQUNmLENBQUM7Z0JBQ0YsQ0FBQztZQUNGLENBQUM7U0FDRCxDQUFDLENBQUM7UUFFSCxJQUFJLE1BQU0sR0FBRyxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2YsSUFBSSxtQkFBaUIsR0FBRyxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ25FLE1BQU0sQ0FBQywyQkFBMkIsQ0FBQyxjQUFjLEVBQUUsbUJBQWlCLENBQUMsQ0FBQztRQUV0RSxJQUFJLGlCQUFlLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQztZQUMxRixrQkFBa0IsWUFBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU07Z0JBQzFDLFlBQVksRUFBRSxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNqQyxDQUFDO1NBQ0QsQ0FBQyxDQUFDO1FBRUgsSUFBSSxvQkFBb0IsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDO1lBQzdGLFlBQVksWUFBQyxPQUFPO2dCQUNuQixJQUFJLENBQUM7b0JBQ0osT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQkFBYyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksaUJBQWUsRUFBRSxFQUFFLG1CQUFpQixDQUFDLENBQUM7Z0JBQ25GLENBQUM7Z0JBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNwQixDQUFDO1lBQ0YsQ0FBQztZQUNELGlCQUFpQixZQUFDLE9BQU87WUFFekIsQ0FBQztTQUNELENBQUMsQ0FBQztRQUVILGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUUsSUFBSSxvQkFBb0IsRUFBRSxFQUFFLG1CQUFpQixDQUFDLENBQUM7SUFDbkcsQ0FBQztJQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7QUFDRixDQUFDO0FBRUQscUJBQXFCLFFBQVE7SUFDNUIsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUNYLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDMUQsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNWLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFDM0QsTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUNaLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDWixDQUFDO0FBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCAqIGFzIGFwcGxpY2F0aW9uIGZyb20gJ2FwcGxpY2F0aW9uJztcbmltcG9ydCAqIGFzIHBhZ2UgZnJvbSAndWkvcGFnZSc7XG5pbXBvcnQgKiBhcyB1dGlsc01vZHVsZSBmcm9tIFwidXRpbHMvdXRpbHNcIjtcblxuZGVjbGFyZSB2YXIgYW5kcm9pZDogYW55O1xuZGVjbGFyZSB2YXIgamF2YTogYW55O1xuXG5pZiAoYXBwbGljYXRpb24uYW5kcm9pZCkge1xuXG5cdHZhciBTVEFURV9QUkVWSUVXID0gMDtcblx0dmFyIFNUQVRFX1dBSVRJTkdfTE9DSyA9IDE7XG5cdHZhciBTVEFURV9XQUlUSU5HX1BSRUNBUFRVUkUgPSAyO1xuXHR2YXIgU1RBVEVfV0FJVElOR19OT05fUFJFQ0FQVFVSRSA9IDM7XG5cdHZhciBTVEFURV9QSUNUVVJFX1RBS0VOID0gNDtcblx0dmFyIG1TdGF0ZSA9IFNUQVRFX1BSRVZJRVc7XG5cblx0dmFyIG1UZXh0dXJlVmlldzogYW55O1xuXHR2YXIgbVByZXZpZXdTaXplOiBhbnkgPSBudWxsO1xuXHR2YXIgbUNhbWVyYURldmljZTogYW55ID0gbnVsbDtcblx0dmFyIG1QcmV2aWV3QnVpbGRlcjogYW55ID0gbnVsbDtcblx0dmFyIG1QcmV2aWV3U2Vzc2lvbjogYW55ID0gbnVsbDtcblxuXHR2YXIgbVN0YXRlQ2FsbGJhY2s6IGFueSA9IG51bGw7XG5cdHZhciBtUHJldmlld1N0YXRlQ2FsbGJhY2s6IGFueSA9IG51bGw7XG59XG52YXIgbVN1cmZhY2VUZXh0dXJlTGlzdGVuZXI7XG52YXIgTXlTdGF0ZUNhbGxiYWNrO1xudmFyIE15UHJldmlld1N0YXRlQ2FsbGJhY2s7XG5cbkBDb21wb25lbnQoe1xuXHRtb2R1bGVJZDogbW9kdWxlLmlkLFxuXHRzZWxlY3RvcjogJ2FuZHJvaWQtY2FtZXJhLXByZXZpZXcnLFxuXHR0ZW1wbGF0ZVVybDogJ2FuZHJvaWQtY2FtZXJhLXByZXZpZXcuY29tcG9uZW50Lmh0bWwnLFxuXHRzdHlsZVVybHM6IFsnYW5kcm9pZC1jYW1lcmEtcHJldmlldy5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBBbmRyb2lkQ2FtZXJhUHJldmlld0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cblx0cHJpdmF0ZSBzdGF0aWMgVEFHID0gJ05OR0NhbWVyYVByZXZpZXcnO1xuXG5cdGNvbnN0cnVjdG9yKCkge1xuXHR9XG5cblx0bmdPbkluaXQoKTogdm9pZCB7XG5cdFx0QW5kcm9pZENhbWVyYVByZXZpZXdDb21wb25lbnQucmVxdWVzdFBlcm1pc3Npb25zKCk7XG5cdH1cblxuXHRwdWJsaWMgdGFrZVBob3RvKCkge1xuXHRcdGNhcHR1cmVJbWFnZSgpO1xuXHR9XG5cblx0Ly8gSW5pdFxuXHRwcml2YXRlIG9uQ3JlYXRpbmdWaWV3KGFyZ3MpOiB2b2lkIHtcblx0XHRtVGV4dHVyZVZpZXcgPSBuZXcgYW5kcm9pZC52aWV3LlRleHR1cmVWaWV3KGFwcGxpY2F0aW9uLmFuZHJvaWQuY29udGV4dCk7XG5cdFx0bVRleHR1cmVWaWV3LnNldFN1cmZhY2VUZXh0dXJlTGlzdGVuZXIobVN1cmZhY2VUZXh0dXJlTGlzdGVuZXIpO1xuXHRcdGFyZ3MudmlldyA9IG1UZXh0dXJlVmlldztcblx0fVxuXG5cdC8qIFN0YXRpYyBNZXRob2RzICovXG5cdHB1YmxpYyBzdGF0aWMgaXNBdmFpbGFibGUoKSB7XG5cdFx0dmFyIHV0aWxzOiB0eXBlb2YgdXRpbHNNb2R1bGUgPSByZXF1aXJlKFwidXRpbHMvdXRpbHNcIik7XG5cblx0XHRyZXR1cm4gdXRpbHMuYWQuZ2V0QXBwbGljYXRpb25Db250ZXh0KCkuZ2V0UGFja2FnZU1hbmFnZXIoKS5oYXNTeXN0ZW1GZWF0dXJlKGFuZHJvaWQuY29udGVudC5wbS5QYWNrYWdlTWFuYWdlci5GRUFUVVJFX0NBTUVSQSlcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgcmVxdWVzdFBlcm1pc3Npb25zKCkge1xuXHRcdGxldCBSRVFVRVNUX1JFUVVJUkVEX1BFUk1JU1NJT05TID0gMTIzNDtcblx0XHRpZiAoIUFuZHJvaWRDYW1lcmFQcmV2aWV3Q29tcG9uZW50Lmhhc1Blcm1pc3Npb25zKCkpIHtcblx0XHRcdCg8YW55PmFuZHJvaWQuc3VwcG9ydC52NC5hcHAuQWN0aXZpdHlDb21wYXQpLnJlcXVlc3RQZXJtaXNzaW9ucyhhcHBsaWNhdGlvbi5hbmRyb2lkLmN1cnJlbnRDb250ZXh0LCBbKDxhbnk+YW5kcm9pZCkuTWFuaWZlc3QucGVybWlzc2lvbi5DQU1FUkEsICg8YW55PmFuZHJvaWQpLk1hbmlmZXN0LnBlcm1pc3Npb24uV1JJVEVfRVhURVJOQUxfU1RPUkFHRV0sIFJFUVVFU1RfUkVRVUlSRURfUEVSTUlTU0lPTlMpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgaGFzUGVybWlzc2lvbnMoKSB7XG5cdFx0Y29uc29sZS5sb2coXCJjaGVja2luZyBwZXJtaXNzaW9ucyAuLi4uXCIpO1xuXHRcdHJldHVybiAoPGFueT5hbmRyb2lkLnN1cHBvcnQudjQuY29udGVudC5Db250ZXh0Q29tcGF0KS5jaGVja1NlbGZQZXJtaXNzaW9uKGFwcGxpY2F0aW9uLmFuZHJvaWQuY3VycmVudENvbnRleHQsICg8YW55PmFuZHJvaWQpLk1hbmlmZXN0LnBlcm1pc3Npb24uV1JJVEVfRVhURVJOQUxfU1RPUkFHRSkgPT09IGFuZHJvaWQuY29udGVudC5wbS5QYWNrYWdlTWFuYWdlci5QRVJNSVNTSU9OX0dSQU5URURcblx0XHRcdCYmICg8YW55PmFuZHJvaWQuc3VwcG9ydC52NC5jb250ZW50LkNvbnRleHRDb21wYXQpLmNoZWNrU2VsZlBlcm1pc3Npb24oYXBwbGljYXRpb24uYW5kcm9pZC5jdXJyZW50Q29udGV4dCwgKDxhbnk+YW5kcm9pZCkuTWFuaWZlc3QucGVybWlzc2lvbi5DQU1FUkEpID09PSBhbmRyb2lkLmNvbnRlbnQucG0uUGFja2FnZU1hbmFnZXIuUEVSTUlTU0lPTl9HUkFOVEVEO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHN0YXJ0UHJldmlldygpIHtcblxuXHRsZXQgdGV4dHVyZSA9IG1UZXh0dXJlVmlldy5nZXRTdXJmYWNlVGV4dHVyZSgpO1xuXHRpZiAodGV4dHVyZSA9PSBudWxsKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0dGV4dHVyZS5zZXREZWZhdWx0QnVmZmVyU2l6ZShtUHJldmlld1NpemUuZ2V0V2lkdGgoKSwgbVByZXZpZXdTaXplLmdldEhlaWdodCgpKTtcblx0bGV0IHN1cmZhY2UgPSBuZXcgYW5kcm9pZC52aWV3LlN1cmZhY2UodGV4dHVyZSk7XG5cblx0dHJ5IHtcblx0XHRtUHJldmlld0J1aWxkZXIgPSBtQ2FtZXJhRGV2aWNlLmNyZWF0ZUNhcHR1cmVSZXF1ZXN0KGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFEZXZpY2UuVEVNUExBVEVfUFJFVklFVyk7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0fVxuXG5cdG1QcmV2aWV3QnVpbGRlci5hZGRUYXJnZXQoc3VyZmFjZSk7XG5cdHRyeSB7XG5cdFx0aWYgKG1QcmV2aWV3U3RhdGVDYWxsYmFjayA9PSBudWxsKSB7XG5cdFx0XHRtUHJldmlld1N0YXRlQ2FsbGJhY2sgPSBuZXcgTXlQcmV2aWV3U3RhdGVDYWxsYmFjaygpO1xuXHRcdH1cblx0XHRsZXQgc3VyZmFjZUxpc3QgPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdCgpO1xuXHRcdHN1cmZhY2VMaXN0LmFkZChzdXJmYWNlKTtcblxuXHRcdG1DYW1lcmFEZXZpY2UuY3JlYXRlQ2FwdHVyZVNlc3Npb24oc3VyZmFjZUxpc3QsIG1QcmV2aWV3U3RhdGVDYWxsYmFjaywgbnVsbCk7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0fVxufVxuXG5pZiAoYXBwbGljYXRpb24uYW5kcm9pZCkge1xuXHQvKiBMaXN0ZW5lcnMgKi9cblx0bVN1cmZhY2VUZXh0dXJlTGlzdGVuZXIgPSBuZXcgYW5kcm9pZC52aWV3LlRleHR1cmVWaWV3LlN1cmZhY2VUZXh0dXJlTGlzdGVuZXIoe1xuXHRcdG9uU3VyZmFjZVRleHR1cmVBdmFpbGFibGUoc3VyZmFjZSwgd2lkdGgsIGhlaWdodCkge1xuXHRcdFx0Y29uc29sZS5sb2coJ1N1cmZhY2VUZXh0dXJlTGlzdGVuZXIgb25TdXJmYWNlVGV4dHVyZUF2YWlsYWJsZScpO1xuXHRcdFx0bGV0IGFwcENvbnRleHQgPSBhcHBsaWNhdGlvbi5hbmRyb2lkLmZvcmVncm91bmRBY3Rpdml0eTtcblx0XHRcdGxldCBtYW5hZ2VyID0gYXBwQ29udGV4dC5nZXRTeXN0ZW1TZXJ2aWNlKGFuZHJvaWQuY29udGVudC5Db250ZXh0LkNBTUVSQV9TRVJWSUNFKTtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGxldCBjYW1lcmFJZCA9IG1hbmFnZXIuZ2V0Q2FtZXJhSWRMaXN0KClbMF07IC8vIFRPRE86IGZpbmQgdGhlIGJhY2sgZmFjaW5nIGNhbWVyYVxuXHRcdFx0XHRsZXQgY2hhcmFjdGVyaXN0aWNzID0gbWFuYWdlci5nZXRDYW1lcmFDaGFyYWN0ZXJpc3RpY3MoY2FtZXJhSWQpO1xuXHRcdFx0XHRsZXQgbWFwID0gY2hhcmFjdGVyaXN0aWNzLmdldChhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FtZXJhQ2hhcmFjdGVyaXN0aWNzLlNDQUxFUl9TVFJFQU1fQ09ORklHVVJBVElPTl9NQVApO1xuXHRcdFx0XHRtUHJldmlld1NpemUgPSBtYXAuZ2V0T3V0cHV0U2l6ZXMoYW5kcm9pZC5ncmFwaGljcy5TdXJmYWNlVGV4dHVyZS5jbGFzcylbMF07XG5cblx0XHRcdFx0aWYgKG1TdGF0ZUNhbGxiYWNrID09IG51bGwpIHtcblx0XHRcdFx0XHRtU3RhdGVDYWxsYmFjayA9IG5ldyBNeVN0YXRlQ2FsbGJhY2soKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG1hbmFnZXIub3BlbkNhbWVyYShjYW1lcmFJZCwgbVN0YXRlQ2FsbGJhY2ssIG51bGwpO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdG9uU3VyZmFjZVRleHR1cmVVcGRhdGVkKHN1cmZhY2UpIHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKCdTdXJmYWNlVGV4dHVyZUxpc3RlbmVyIG9uU3VyZmFjZVRleHR1cmVVcGRhdGVkJyk7XG5cdFx0fSxcblx0XHRvblN1cmZhY2VUZXh0dXJlU2l6ZUNoYW5nZWQoc3VyZmFjZSwgd2lkdGgsIGhlaWdodCkge1xuXHRcdFx0Y29uc29sZS5sb2coJ1N1cmZhY2VUZXh0dXJlTGlzdGVuZXIgb25TdXJmYWNlVGV4dHVyZVNpemVDaGFuZ2VkJyk7XG5cdFx0fSxcblx0XHRvblN1cmZhY2VUZXh0dXJlRGVzdHJveWVkKHN1cmZhY2UpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdTdXJmYWNlVGV4dHVyZUxpc3RlbmVyIG9uU3VyZmFjZVRleHR1cmVEZXN0cm95ZWQnKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH0pO1xuXG5cblx0LyogQ2FsbGJhY2tzICovXG5cdE15U3RhdGVDYWxsYmFjayA9IGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFEZXZpY2UuU3RhdGVDYWxsYmFjay5leHRlbmQoe1xuXHRcdG9uT3BlbmVkKGNhbWVyYSkge1xuXHRcdFx0Y29uc29sZS5sb2coJ0NhbWVyYURldmljZS5TdGF0ZUNhbGxiYWNrIG9uT3BlbmVkJyk7XG5cdFx0XHRtQ2FtZXJhRGV2aWNlID0gY2FtZXJhO1xuXHRcdFx0c3RhcnRQcmV2aWV3KCk7XG5cdFx0fSxcblx0XHRvbkVycm9yKGNhbWVyYSwgZXJyb3IpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoJ0NhbWVyYURldmljZS5TdGF0ZUNhbGxiYWNrRXJyb3I6ICcgKyBlcnJvcik7XG5cdFx0fSxcblx0XHRvbkRpc2Nvbm5lY3RlZChjYW1lcmEpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdDYW1lcmFEZXZpY2UuU3RhdGVDYWxsYmFjayBvbkRpc2Nvbm5lY3RlZCcpO1xuXHRcdH1cblx0fSk7XG5cblx0TXlQcmV2aWV3U3RhdGVDYWxsYmFjayA9IGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFDYXB0dXJlU2Vzc2lvbi5TdGF0ZUNhbGxiYWNrLmV4dGVuZCh7XG5cdFx0b25Db25maWd1cmVkKHNlc3Npb24pIHtcblx0XHRcdGNvbnNvbGUubG9nKCdDYW1lcmFDYXB0dXJlU2Vzc2lvbi5TdGF0ZUNhbGxiYWNrIG9uQ29uZmlndXJlZCcpO1xuXHRcdFx0bVByZXZpZXdTZXNzaW9uID0gc2Vzc2lvbjtcblxuXHRcdFx0bVByZXZpZXdCdWlsZGVyLnNldChhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FwdHVyZVJlcXVlc3QuQ09OVFJPTF9NT0RFLFxuXHRcdFx0XHRqYXZhLmxhbmcuSW50ZWdlci52YWx1ZU9mKGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFNZXRhZGF0YS5DT05UUk9MX01PREVfQVVUTykpO1xuXG5cdFx0XHRsZXQgYmFja2dyb3VuZFRocmVhZCA9IG5ldyBhbmRyb2lkLm9zLkhhbmRsZXJUaHJlYWQoJ05OR0NhbWVyYVByZXZpZXcnKTtcblx0XHRcdGJhY2tncm91bmRUaHJlYWQuc3RhcnQoKTtcblx0XHRcdGxldCBiYWNrZ3JvdW5kSGFuZGxlciA9IG5ldyBhbmRyb2lkLm9zLkhhbmRsZXIoYmFja2dyb3VuZFRocmVhZC5nZXRMb29wZXIoKSk7XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdG1QcmV2aWV3U2Vzc2lvbi5zZXRSZXBlYXRpbmdSZXF1ZXN0KG1QcmV2aWV3QnVpbGRlci5idWlsZCgpLCBudWxsLCBiYWNrZ3JvdW5kSGFuZGxlcik7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0b25Db25maWd1cmVGYWlsZWQoc2Vzc2lvbikge1xuXHRcdFx0Y29uc29sZS5sb2coJ0NhbWVyYUNhcHR1cmVTZXNzaW9uIENvbmZpZ3VyZSBmYWlsZWQnKTtcblx0XHR9XG5cdH0pO1xuXG5cbn1cblxuXG5cdC8qIElNQUdFIENBUFRVUkUgKi9cblx0ZnVuY3Rpb24gY2FwdHVyZUltYWdlKCkge1xuXHRcdGlmIChudWxsID09IG1DYW1lcmFEZXZpY2UpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0bGV0IGFwcENvbnRleHQgPSBhcHBsaWNhdGlvbi5hbmRyb2lkLmZvcmVncm91bmRBY3Rpdml0eTtcblx0XHRsZXQgbWFuYWdlciA9IGFwcENvbnRleHQuZ2V0U3lzdGVtU2VydmljZShhbmRyb2lkLmNvbnRlbnQuQ29udGV4dC5DQU1FUkFfU0VSVklDRSk7XG5cdFx0dHJ5IHtcblx0XHRcdGxldCBjaGFyYWN0ZXJpc3RpY3MgPSBtYW5hZ2VyLmdldENhbWVyYUNoYXJhY3RlcmlzdGljcyhtQ2FtZXJhRGV2aWNlLmdldElkKCkpO1xuXG5cdFx0XHRsZXQganBlZ1NpemVzOiBhbnkgPSBudWxsO1xuXHRcdFx0aWYgKGNoYXJhY3RlcmlzdGljcyAhPSBudWxsKSB7XG5cdFx0XHRcdGpwZWdTaXplcyA9IGNoYXJhY3RlcmlzdGljc1xuXHRcdFx0XHRcdC5nZXQoYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYUNoYXJhY3RlcmlzdGljcy5TQ0FMRVJfU1RSRUFNX0NPTkZJR1VSQVRJT05fTUFQKVxuXHRcdFx0XHRcdC5nZXRPdXRwdXRTaXplcyhhbmRyb2lkLmdyYXBoaWNzLkltYWdlRm9ybWF0LkpQRUcpO1xuXHRcdFx0fVxuXHRcdFx0bGV0IHdpZHRoID0gNjQwOyAvLyBkZWZhdWx0XG5cdFx0XHRsZXQgaGVpZ2h0ID0gNDgwOyAvLyBkZWZhdWx0XG5cdFx0XHRpZiAoanBlZ1NpemVzICE9IG51bGwgJiYganBlZ1NpemVzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0d2lkdGggPSBqcGVnU2l6ZXNbMF0uZ2V0V2lkdGgoKTtcblx0XHRcdFx0aGVpZ2h0ID0ganBlZ1NpemVzWzBdLmdldEhlaWdodCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgcmVhZGVyID0gYW5kcm9pZC5tZWRpYS5JbWFnZVJlYWRlci5uZXdJbnN0YW5jZSh3aWR0aCwgaGVpZ2h0LCBhbmRyb2lkLmdyYXBoaWNzLkltYWdlRm9ybWF0LkpQRUcsIDEpO1xuXHRcdFx0bGV0IG91dHB1dFN1cmZhY2VzID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3QoKTtcblx0XHRcdG91dHB1dFN1cmZhY2VzLmFkZChyZWFkZXIuZ2V0U3VyZmFjZSgpKTtcblx0XHRcdG91dHB1dFN1cmZhY2VzLmFkZChuZXcgYW5kcm9pZC52aWV3LlN1cmZhY2UobVRleHR1cmVWaWV3LmdldFN1cmZhY2VUZXh0dXJlKCkpKTtcblxuXHRcdFx0bGV0IGNhcHR1cmVCdWlsZGVyID0gbUNhbWVyYURldmljZS5jcmVhdGVDYXB0dXJlUmVxdWVzdChhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FtZXJhRGV2aWNlLlRFTVBMQVRFX1NUSUxMX0NBUFRVUkUpO1xuXHRcdFx0Y2FwdHVyZUJ1aWxkZXIuYWRkVGFyZ2V0KHJlYWRlci5nZXRTdXJmYWNlKCkpO1xuXHRcdFx0Y2FwdHVyZUJ1aWxkZXIuc2V0KGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYXB0dXJlUmVxdWVzdC5DT05UUk9MX01PREUsXG5cdFx0XHRcdGphdmEubGFuZy5JbnRlZ2VyLnZhbHVlT2YoYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYU1ldGFkYXRhLkNPTlRST0xfTU9ERV9BVVRPKSk7XG5cblx0XHRcdC8vIFRPRE86IHJvdGF0aW9uXG5cdFx0XHQvLyBsZXQgcm90YXRpb24gPSBhcHBDb250ZXh0LmdldFdpbmRvd01hbmFnZXIoKS5nZXREZWZhdWx0RGlzcGxheSgpLmdldFJvdGF0aW9uKCk7XG5cdFx0XHQvLyBjYXB0dXJlQnVpbGRlci5zZXQoYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhcHR1cmVSZXF1ZXN0LkpQRUdfT1JJRU5UQVRJT04sIGphdmEubGFuZy5JbnRlZ2VyLnZhbHVlT2YoZ2V0Um90YXRpb24ocm90YXRpb24pKSk7XG5cblx0XHRcdGxldCBmaWxlID0gbmV3IGphdmEuaW8uRmlsZShhbmRyb2lkLm9zLkVudmlyb25tZW50LmdldEV4dGVybmFsU3RvcmFnZURpcmVjdG9yeSgpICsgXCIvRENJTVwiLCBcInBpY1wiICsgKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5OTkpICsgMSkgKyBcIi5qcGdcIik7XG5cdFx0XHRsZXQgcmVhZGVyTGlzdGVuZXIgPSBuZXcgYW5kcm9pZC5tZWRpYS5JbWFnZVJlYWRlci5PbkltYWdlQXZhaWxhYmxlTGlzdGVuZXIoe1xuXHRcdFx0XHRzYXZlKGJ5dGVzKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ1NhdmluZyBCeXRlcycpO1xuXHRcdFx0XHRcdGxldCBvdXRwdXQgPSBudWxsO1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRvdXRwdXQgPSBuZXcgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtKGZpbGUpO1xuXHRcdFx0XHRcdFx0b3V0cHV0LndyaXRlKGJ5dGVzKTtcblx0XHRcdFx0XHR9IGZpbmFsbHkge1xuXHRcdFx0XHRcdFx0aWYgKG91dHB1dCAhPSBudWxsKSB7XG5cdFx0XHRcdFx0XHRcdG91dHB1dC5jbG9zZSgpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSxcblx0XHRcdFx0b25JbWFnZUF2YWlsYWJsZShyZWFkZXIpIHtcblx0XHRcdFx0XHRsZXQgaW1hZ2UgPSBudWxsO1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRpbWFnZSA9IHJlYWRlci5hY3F1aXJlTGF0ZXN0SW1hZ2UoKTtcblx0XHRcdFx0XHRcdGxldCBidWZmZXIgPSBpbWFnZS5nZXRQbGFuZXMoKVswXS5nZXRCdWZmZXIoKTtcblx0XHRcdFx0XHRcdGxldCBieXRlcyA9ICg8YW55PkFycmF5KS5jcmVhdGUoJ2J5dGUnLCBidWZmZXIuY2FwYWNpdHkoKSk7XG5cdFx0XHRcdFx0XHRidWZmZXIuZ2V0KGJ5dGVzKTtcblx0XHRcdFx0XHRcdHRoaXMuc2F2ZShieXRlcyk7XG5cdFx0XHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdFx0fSBmaW5hbGx5IHtcblx0XHRcdFx0XHRcdGlmIChpbWFnZSAhPSBudWxsKSB7XG5cdFx0XHRcdFx0XHRcdGltYWdlLmNsb3NlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0bGV0IHRocmVhZCA9IG5ldyBhbmRyb2lkLm9zLkhhbmRsZXJUaHJlYWQoJ05OR0NhbWVyYVByZXZpZXcnKTtcblx0XHRcdHRocmVhZC5zdGFydCgpO1xuXHRcdFx0bGV0IGJhY2tncm91bmRIYW5kbGVyID0gbmV3IGFuZHJvaWQub3MuSGFuZGxlcih0aHJlYWQuZ2V0TG9vcGVyKCkpO1xuXHRcdFx0cmVhZGVyLnNldE9uSW1hZ2VBdmFpbGFibGVMaXN0ZW5lcihyZWFkZXJMaXN0ZW5lciwgYmFja2dyb3VuZEhhbmRsZXIpO1xuXG5cdFx0XHRsZXQgY2FwdHVyZUxpc3RlbmVyID0gYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYUNhcHR1cmVTZXNzaW9uLkNhcHR1cmVDYWxsYmFjay5leHRlbmQoe1xuXHRcdFx0XHRvbkNhcHR1cmVDb21wbGV0ZWQoc2Vzc2lvbiwgcmVxdWVzdCwgcmVzdWx0KSB7XG5cdFx0XHRcdFx0c3RhcnRQcmV2aWV3KCk7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ0NhcHR1cmUgQ29tcGxldGUnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGxldCBjYXB0dXJlU3RhdGVDYWxsYmFjayA9IGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFDYXB0dXJlU2Vzc2lvbi5TdGF0ZUNhbGxiYWNrLmV4dGVuZCh7XG5cdFx0XHRcdG9uQ29uZmlndXJlZChzZXNzaW9uKSB7XG5cdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdHNlc3Npb24uY2FwdHVyZShjYXB0dXJlQnVpbGRlci5idWlsZCgpLCBuZXcgY2FwdHVyZUxpc3RlbmVyKCksIGJhY2tncm91bmRIYW5kbGVyKTtcblx0XHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uQ29uZmlndXJlRmFpbGVkKHNlc3Npb24pIHtcblxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0bUNhbWVyYURldmljZS5jcmVhdGVDYXB0dXJlU2Vzc2lvbihvdXRwdXRTdXJmYWNlcywgbmV3IGNhcHR1cmVTdGF0ZUNhbGxiYWNrKCksIGJhY2tncm91bmRIYW5kbGVyKTtcblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBnZXRSb3RhdGlvbihyb3RhdGlvbikge1xuXHRcdGlmIChyb3RhdGlvbiA9PT0gYW5kcm9pZC52aWV3LlN1cmZhY2UuUk9UQVRJT05fMCkge1xuXHRcdFx0cmV0dXJuIDkwO1xuXHRcdH0gZWxzZSBpZiAocm90YXRpb24gPT09IGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzkwKSB7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9IGVsc2UgaWYgKHJvdGF0aW9uID09PSBhbmRyb2lkLnZpZXcuU3VyZmFjZS5ST1RBVElPTl8xODApIHtcblx0XHRcdHJldHVybiAyNzA7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiAxODA7XG5cdFx0fVxuXHR9Il19