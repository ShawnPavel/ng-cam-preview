"use strict";
var core_1 = require("@angular/core");
var application = require("application");
var STATE_PREVIEW = 0;
var STATE_WAITING_LOCK = 1;
var STATE_WAITING_PRECAPTURE = 2;
var STATE_WAITING_NON_PRECAPTURE = 3;
var STATE_PICTURE_TAKEN = 4;
var mState = STATE_PREVIEW;
var mTextureView;
var mPreviewSize = null;
var mCameraDevice = null;
var mPreviewBuilder = null;
var mPreviewSession = null;
var mStateCallback = null;
var mPreviewStateCallback = null;
var AndroidCameraPreviewComponent = AndroidCameraPreviewComponent_1 = (function () {
    function AndroidCameraPreviewComponent() {
    }
    AndroidCameraPreviewComponent.prototype.ngOnInit = function () {
        AndroidCameraPreviewComponent_1.requestPermissions();
    };
    AndroidCameraPreviewComponent.prototype.takePhoto = function () {
        captureImage();
    };
    // Init
    AndroidCameraPreviewComponent.prototype.onCreatingView = function (args) {
        mTextureView = new android.view.TextureView(application.android.context);
        mTextureView.setSurfaceTextureListener(mSurfaceTextureListener);
        args.view = mTextureView;
    };
    /* Static Methods */
    AndroidCameraPreviewComponent.isAvailable = function () {
        var utils = require("utils/utils");
        return utils.ad.getApplicationContext().getPackageManager().hasSystemFeature(android.content.pm.PackageManager.FEATURE_CAMERA);
    };
    AndroidCameraPreviewComponent.requestPermissions = function () {
        var REQUEST_REQUIRED_PERMISSIONS = 1234;
        if (!AndroidCameraPreviewComponent_1.hasPermissions()) {
            android.support.v4.app.ActivityCompat.requestPermissions(application.android.currentContext, [android.Manifest.permission.CAMERA, android.Manifest.permission.WRITE_EXTERNAL_STORAGE], REQUEST_REQUIRED_PERMISSIONS);
        }
    };
    AndroidCameraPreviewComponent.hasPermissions = function () {
        console.log("checking permissions ....");
        return android.support.v4.content.ContextCompat.checkSelfPermission(application.android.currentContext, android.Manifest.permission.WRITE_EXTERNAL_STORAGE) === android.content.pm.PackageManager.PERMISSION_GRANTED
            && android.support.v4.content.ContextCompat.checkSelfPermission(application.android.currentContext, android.Manifest.permission.CAMERA) === android.content.pm.PackageManager.PERMISSION_GRANTED;
    };
    AndroidCameraPreviewComponent.hasDeniedPermissions = function () {
        console.log("checking permissions ....");
        return android.support.v4.content.ContextCompat.checkSelfPermission(application.android.currentContext, android.Manifest.permission.WRITE_EXTERNAL_STORAGE) === android.content.pm.PackageManager.PERMISSION_DENIED
            && android.support.v4.content.ContextCompat.checkSelfPermission(application.android.currentContext, android.Manifest.permission.CAMERA) === android.content.pm.PackageManager.PERMISSION_DENIED;
    };
    return AndroidCameraPreviewComponent;
}());
AndroidCameraPreviewComponent.TAG = 'NNGCameraPreview';
AndroidCameraPreviewComponent = AndroidCameraPreviewComponent_1 = __decorate([
    core_1.Component({
        moduleId: module.id,
        selector: 'android-camera-preview',
        templateUrl: 'android-camera-preview.component.html',
        styleUrls: ['android-camera-preview.css']
    }),
    __metadata("design:paramtypes", [])
], AndroidCameraPreviewComponent);
exports.AndroidCameraPreviewComponent = AndroidCameraPreviewComponent;
function startPreview() {
    var texture = mTextureView.getSurfaceTexture();
    if (texture == null) {
        return;
    }
    texture.setDefaultBufferSize(mPreviewSize.getWidth(), mPreviewSize.getHeight());
    var surface = new android.view.Surface(texture);
    try {
        mPreviewBuilder = mCameraDevice.createCaptureRequest(android.hardware.camera2.CameraDevice.TEMPLATE_PREVIEW);
    }
    catch (err) {
        console.error(err);
    }
    mPreviewBuilder.addTarget(surface);
    try {
        if (mPreviewStateCallback == null) {
            mPreviewStateCallback = new MyPreviewStateCallback();
        }
        var surfaceList = new java.util.ArrayList();
        surfaceList.add(surface);
        mCameraDevice.createCaptureSession(surfaceList, mPreviewStateCallback, null);
    }
    catch (err) {
        console.error(err);
    }
}
/* Listeners */
var mSurfaceTextureListener = new android.view.TextureView.SurfaceTextureListener({
    onSurfaceTextureAvailable: function (surface, width, height) {
        console.log('SurfaceTextureListener onSurfaceTextureAvailable');
        var appContext = application.android.foregroundActivity;
        var manager = appContext.getSystemService(android.content.Context.CAMERA_SERVICE);
        try {
            var cameraId = manager.getCameraIdList()[0]; // TODO: find the back facing camera
            var characteristics = manager.getCameraCharacteristics(cameraId);
            var map = characteristics.get(android.hardware.camera2.CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);
            mPreviewSize = map.getOutputSizes(android.graphics.SurfaceTexture.class)[0];
            if (mStateCallback == null) {
                mStateCallback = new MyStateCallback();
            }
            manager.openCamera(cameraId, mStateCallback, null);
        }
        catch (err) {
            console.error(err);
        }
    },
    onSurfaceTextureUpdated: function (surface) {
        // console.log('SurfaceTextureListener onSurfaceTextureUpdated');
    },
    onSurfaceTextureSizeChanged: function (surface, width, height) {
        console.log('SurfaceTextureListener onSurfaceTextureSizeChanged');
    },
    onSurfaceTextureDestroyed: function (surface) {
        console.log('SurfaceTextureListener onSurfaceTextureDestroyed');
        return false;
    }
});
/* Callbacks */
var MyStateCallback = android.hardware.camera2.CameraDevice.StateCallback.extend({
    onOpened: function (camera) {
        console.log('CameraDevice.StateCallback onOpened');
        mCameraDevice = camera;
        startPreview();
    },
    onError: function (camera, error) {
        console.error('CameraDevice.StateCallbackError: ' + error);
    },
    onDisconnected: function (camera) {
        console.log('CameraDevice.StateCallback onDisconnected');
    }
});
var MyPreviewStateCallback = android.hardware.camera2.CameraCaptureSession.StateCallback.extend({
    onConfigured: function (session) {
        console.log('CameraCaptureSession.StateCallback onConfigured');
        var appContext = application.android.foregroundActivity;
        mPreviewSession = session;
        mPreviewBuilder.set(android.hardware.camera2.CaptureRequest.CONTROL_MODE, java.lang.Integer.valueOf(android.hardware.camera2.CameraMetadata.CONTROL_MODE_AUTO));
        var backgroundThread = new android.os.HandlerThread('NNGCameraPreview');
        backgroundThread.start();
        var backgroundHandler = new android.os.Handler(backgroundThread.getLooper());
        try {
            mPreviewSession.setRepeatingRequest(mPreviewBuilder.build(), null, backgroundHandler);
        }
        catch (err) {
            console.error(err);
        }
    },
    onConfigureFailed: function (session) {
        console.log('CameraCaptureSession Configure failed');
    }
});
/* IMAGE CAPTURE */
function captureImage() {
    if (null == mCameraDevice) {
        return;
    }
    var appContext = application.android.foregroundActivity;
    var manager = appContext.getSystemService(android.content.Context.CAMERA_SERVICE);
    try {
        var characteristics = manager.getCameraCharacteristics(mCameraDevice.getId());
        var jpegSizes = null;
        if (characteristics != null) {
            jpegSizes = characteristics
                .get(android.hardware.camera2.CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP)
                .getOutputSizes(android.graphics.ImageFormat.JPEG);
        }
        var width = 640; // default
        var height = 480; // default
        if (jpegSizes != null && jpegSizes.length > 0) {
            width = jpegSizes[0].getWidth();
            height = jpegSizes[0].getHeight();
        }
        var reader = android.media.ImageReader.newInstance(width, height, android.graphics.ImageFormat.JPEG, 1);
        var outputSurfaces = new java.util.ArrayList();
        outputSurfaces.add(reader.getSurface());
        outputSurfaces.add(new android.view.Surface(mTextureView.getSurfaceTexture()));
        var captureBuilder_1 = mCameraDevice.createCaptureRequest(android.hardware.camera2.CameraDevice.TEMPLATE_STILL_CAPTURE);
        captureBuilder_1.addTarget(reader.getSurface());
        captureBuilder_1.set(android.hardware.camera2.CaptureRequest.CONTROL_MODE, java.lang.Integer.valueOf(android.hardware.camera2.CameraMetadata.CONTROL_MODE_AUTO));
        // TODO: rotation
        var rotation = appContext.getWindowManager().getDefaultDisplay().getRotation();
        captureBuilder_1.set(android.hardware.camera2.CaptureRequest.JPEG_ORIENTATION, java.lang.Integer.valueOf(getRotation(rotation)));
        var file_1 = new java.io.File(android.os.Environment.getExternalStorageDirectory() + "/DCIM", "pic.jpg");
        var readerListener = new android.media.ImageReader.OnImageAvailableListener({
            save: function (bytes) {
                console.log('Saving Bytes');
                var output = null;
                try {
                    output = new java.io.FileOutputStream(file_1);
                    output.write(bytes);
                }
                finally {
                    if (output != null) {
                        output.close();
                    }
                }
            },
            onImageAvailable: function (reader) {
                var image = null;
                try {
                    image = reader.acquireLatestImage();
                    var buffer = image.getPlanes()[0].getBuffer();
                    // const bytes = new java.lang.Byte[buffer.capacity()];
                    var bytes = Array.create('byte', buffer.capacity());
                    buffer.get(bytes);
                    this.save(bytes);
                }
                catch (err) {
                    console.error(err);
                }
                finally {
                    if (image != null) {
                        image.close();
                    }
                }
            }
        });
        var thread = new android.os.HandlerThread('NNGCameraPreview');
        thread.start();
        var backgroundHandler_1 = new android.os.Handler(thread.getLooper());
        reader.setOnImageAvailableListener(readerListener, backgroundHandler_1);
        var captureListener_1 = android.hardware.camera2.CameraCaptureSession.CaptureCallback.extend({
            onCaptureCompleted: function (session, request, result) {
                startPreview();
                console.log('Capture Complete');
            }
        });
        var captureStateCallback = android.hardware.camera2.CameraCaptureSession.StateCallback.extend({
            onConfigured: function (session) {
                try {
                    session.capture(captureBuilder_1.build(), new captureListener_1(), backgroundHandler_1);
                }
                catch (err) {
                    console.error(err);
                }
            },
            onConfigureFailed: function (session) {
            }
        });
        mCameraDevice.createCaptureSession(outputSurfaces, new captureStateCallback(), backgroundHandler_1);
    }
    catch (err) {
        console.error(err);
    }
}
function getRotation(rotation) {
    if (rotation === android.view.Surface.ROTATION_0) {
        return 90;
    }
    else if (rotation === android.view.Surface.ROTATION_90) {
        return 0;
    }
    else if (rotation === android.view.Surface.ROTATION_180) {
        return 270;
    }
    else {
        return 180;
    }
}
var AndroidCameraPreviewComponent_1;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5kcm9pZC1jYW1lcmEtcHJldmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhbmRyb2lkLWNhbWVyYS1wcmV2aWV3LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQWtEO0FBRWxELHlDQUEyQztBQU8zQyxJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUM7QUFDdEIsSUFBSSxrQkFBa0IsR0FBRyxDQUFDLENBQUM7QUFDM0IsSUFBSSx3QkFBd0IsR0FBRyxDQUFDLENBQUM7QUFDakMsSUFBSSw0QkFBNEIsR0FBRyxDQUFDLENBQUM7QUFDckMsSUFBSSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7QUFDNUIsSUFBSSxNQUFNLEdBQUcsYUFBYSxDQUFDO0FBRTNCLElBQUksWUFBaUIsQ0FBQztBQUN0QixJQUFJLFlBQVksR0FBUSxJQUFJLENBQUM7QUFDN0IsSUFBSSxhQUFhLEdBQVEsSUFBSSxDQUFDO0FBQzlCLElBQUksZUFBZSxHQUFRLElBQUksQ0FBQztBQUNoQyxJQUFJLGVBQWUsR0FBUSxJQUFJLENBQUM7QUFFaEMsSUFBSSxjQUFjLEdBQVEsSUFBSSxDQUFDO0FBQy9CLElBQUkscUJBQXFCLEdBQVEsSUFBSSxDQUFDO0FBUXRDLElBQWEsNkJBQTZCO0lBSXpDO0lBQ0EsQ0FBQztJQUVELGdEQUFRLEdBQVI7UUFDQywrQkFBNkIsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQ3BELENBQUM7SUFFTSxpREFBUyxHQUFoQjtRQUNDLFlBQVksRUFBRSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxPQUFPO0lBQ0Msc0RBQWMsR0FBdEIsVUFBdUIsSUFBSTtRQUMxQixZQUFZLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3pFLFlBQVksQ0FBQyx5QkFBeUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ2hFLElBQUks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QUMsb0JBQW9CLENBQUMsY0FBYyxFQUFFLElBQUksb0JBQW9CLEVBQUUsRUFBRSxtQkFBaUIsQ0FBQyxDQUFDO0lBQ25HLENBQUM7SUFBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0FBQ0YsQ0FBQztBQUVELHFCQUFxQixRQUFRO0lBQzVCLEVBQUUsQ0FBQyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sQ0FBQyxFQUFFLENBQUM7SUFDWCxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzFELE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDVixDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQzNELE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDWixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDUCxNQUFNLENBQUMsR0FBRyxDQUFDO0lBQ1osQ0FBQztBQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgKiBhcyBhcHBsaWNhdGlvbiBmcm9tICdhcHBsaWNhdGlvbic7XG5pbXBvcnQgKiBhcyBwYWdlIGZyb20gJ3VpL3BhZ2UnO1xuaW1wb3J0ICogYXMgdXRpbHNNb2R1bGUgZnJvbSBcInV0aWxzL3V0aWxzXCI7XG5cbmRlY2xhcmUgdmFyIGFuZHJvaWQ6IGFueTtcbmRlY2xhcmUgdmFyIGphdmE6IGFueTtcblxudmFyIFNUQVRFX1BSRVZJRVcgPSAwO1xudmFyIFNUQVRFX1dBSVRJTkdfTE9DSyA9IDE7XG52YXIgU1RBVEVfV0FJVElOR19QUkVDQVBUVVJFID0gMjtcbnZhciBTVEFURV9XQUlUSU5HX05PTl9QUkVDQVBUVVJFID0gMztcbnZhciBTVEFURV9QSUNUVVJFX1RBS0VOID0gNDtcbnZhciBtU3RhdGUgPSBTVEFURV9QUkVWSUVXO1xuXG52YXIgbVRleHR1cmVWaWV3OiBhbnk7XG52YXIgbVByZXZpZXdTaXplOiBhbnkgPSBudWxsO1xudmFyIG1DYW1lcmFEZXZpY2U6IGFueSA9IG51bGw7XG52YXIgbVByZXZpZXdCdWlsZGVyOiBhbnkgPSBudWxsO1xudmFyIG1QcmV2aWV3U2Vzc2lvbjogYW55ID0gbnVsbDtcblxudmFyIG1TdGF0ZUNhbGxiYWNrOiBhbnkgPSBudWxsO1xudmFyIG1QcmV2aWV3U3RhdGVDYWxsYmFjazogYW55ID0gbnVsbDtcblxuQENvbXBvbmVudCh7XG5cdG1vZHVsZUlkOiBtb2R1bGUuaWQsXG5cdHNlbGVjdG9yOiAnYW5kcm9pZC1jYW1lcmEtcHJldmlldycsXG5cdHRlbXBsYXRlVXJsOiAnYW5kcm9pZC1jYW1lcmEtcHJldmlldy5jb21wb25lbnQuaHRtbCcsXG5cdHN0eWxlVXJsczogWydhbmRyb2lkLWNhbWVyYS1wcmV2aWV3LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIEFuZHJvaWRDYW1lcmFQcmV2aWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuXHRwcml2YXRlIHN0YXRpYyBUQUcgPSAnTk5HQ2FtZXJhUHJldmlldyc7XG5cblx0Y29uc3RydWN0b3IoKSB7XG5cdH1cblxuXHRuZ09uSW5pdCgpOiB2b2lkIHtcblx0XHRBbmRyb2lkQ2FtZXJhUHJldmlld0NvbXBvbmVudC5yZXF1ZXN0UGVybWlzc2lvbnMoKTtcblx0fVxuXG5cdHB1YmxpYyB0YWtlUGhvdG8oKSB7XG5cdFx0Y2FwdHVyZUltYWdlKCk7XG5cdH1cblxuXHQvLyBJbml0XG5cdHByaXZhdGUgb25DcmVhdGluZ1ZpZXcoYXJncyk6IHZvaWQge1xuXHRcdG1UZXh0dXJlVmlldyA9IG5ldyBhbmRyb2lkLnZpZXcuVGV4dHVyZVZpZXcoYXBwbGljYXRpb24uYW5kcm9pZC5jb250ZXh0KTtcblx0XHRtVGV4dHVyZVZpZXcuc2V0U3VyZmFjZVRleHR1cmVMaXN0ZW5lcihtU3VyZmFjZVRleHR1cmVMaXN0ZW5lcik7XG5cdFx0YXJncy52aWV3ID0gbVRleHR1cmVWaWV3O1xuXHR9XG5cblx0LyogU3RhdGljIE1ldGhvZHMgKi9cblx0cHVibGljIHN0YXRpYyBpc0F2YWlsYWJsZSgpIHtcblx0XHR2YXIgdXRpbHM6IHR5cGVvZiB1dGlsc01vZHVsZSA9IHJlcXVpcmUoXCJ1dGlscy91dGlsc1wiKTtcblxuXHRcdHJldHVybiB1dGlscy5hZC5nZXRBcHBsaWNhdGlvbkNvbnRleHQoKS5nZXRQYWNrYWdlTWFuYWdlcigpLmhhc1N5c3RlbUZlYXR1cmUoYW5kcm9pZC5jb250ZW50LnBtLlBhY2thZ2VNYW5hZ2VyLkZFQVRVUkVfQ0FNRVJBKVxuXHR9XG5cblx0cHVibGljIHN0YXRpYyByZXF1ZXN0UGVybWlzc2lvbnMoKSB7XG5cdFx0bGV0IFJFUVVFU1RfUkVRVUlSRURfUEVSTUlTU0lPTlMgPSAxMjM0O1xuXHRcdGlmICghQW5kcm9pZENhbWVyYVByZXZpZXdDb21wb25lbnQuaGFzUGVybWlzc2lvbnMoKSkge1xuXHRcdFx0KDxhbnk+YW5kcm9pZC5zdXBwb3J0LnY0LmFwcC5BY3Rpdml0eUNvbXBhdCkucmVxdWVzdFBlcm1pc3Npb25zKGFwcGxpY2F0aW9uLmFuZHJvaWQuY3VycmVudENvbnRleHQsIFsoPGFueT5hbmRyb2lkKS5NYW5pZmVzdC5wZXJtaXNzaW9uLkNBTUVSQSwgKDxhbnk+YW5kcm9pZCkuTWFuaWZlc3QucGVybWlzc2lvbi5XUklURV9FWFRFUk5BTF9TVE9SQUdFXSwgUkVRVUVTVF9SRVFVSVJFRF9QRVJNSVNTSU9OUyk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHN0YXRpYyBoYXNQZXJtaXNzaW9ucygpIHtcblx0XHRjb25zb2xlLmxvZyhcImNoZWNraW5nIHBlcm1pc3Npb25zIC4uLi5cIik7XG5cdFx0cmV0dXJuICg8YW55PmFuZHJvaWQuc3VwcG9ydC52NC5jb250ZW50LkNvbnRleHRDb21wYXQpLmNoZWNrU2VsZlBlcm1pc3Npb24oYXBwbGljYXRpb24uYW5kcm9pZC5jdXJyZW50Q29udGV4dCwgKDxhbnk+YW5kcm9pZCkuTWFuaWZlc3QucGVybWlzc2lvbi5XUklURV9FWFRFUk5BTF9TVE9SQUdFKSA9PT0gYW5kcm9pZC5jb250ZW50LnBtLlBhY2thZ2VNYW5hZ2VyLlBFUk1JU1NJT05fR1JBTlRFRFxuXHRcdFx0JiYgKDxhbnk+YW5kcm9pZC5zdXBwb3J0LnY0LmNvbnRlbnQuQ29udGV4dENvbXBhdCkuY2hlY2tTZWxmUGVybWlzc2lvbihhcHBsaWNhdGlvbi5hbmRyb2lkLmN1cnJlbnRDb250ZXh0LCAoPGFueT5hbmRyb2lkKS5NYW5pZmVzdC5wZXJtaXNzaW9uLkNBTUVSQSkgPT09IGFuZHJvaWQuY29udGVudC5wbS5QYWNrYWdlTWFuYWdlci5QRVJNSVNTSU9OX0dSQU5URUQ7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGhhc0RlbmllZFBlcm1pc3Npb25zKCkge1xuXHRcdGNvbnNvbGUubG9nKFwiY2hlY2tpbmcgcGVybWlzc2lvbnMgLi4uLlwiKTtcblx0XHRyZXR1cm4gKDxhbnk+YW5kcm9pZC5zdXBwb3J0LnY0LmNvbnRlbnQuQ29udGV4dENvbXBhdCkuY2hlY2tTZWxmUGVybWlzc2lvbihhcHBsaWNhdGlvbi5hbmRyb2lkLmN1cnJlbnRDb250ZXh0LCAoPGFueT5hbmRyb2lkKS5NYW5pZmVzdC5wZXJtaXNzaW9uLldSSVRFX0VYVEVSTkFMX1NUT1JBR0UpID09PSBhbmRyb2lkLmNvbnRlbnQucG0uUGFja2FnZU1hbmFnZXIuUEVSTUlTU0lPTl9ERU5JRURcblx0XHRcdCYmICg8YW55PmFuZHJvaWQuc3VwcG9ydC52NC5jb250ZW50LkNvbnRleHRDb21wYXQpLmNoZWNrU2VsZlBlcm1pc3Npb24oYXBwbGljYXRpb24uYW5kcm9pZC5jdXJyZW50Q29udGV4dCwgKDxhbnk+YW5kcm9pZCkuTWFuaWZlc3QucGVybWlzc2lvbi5DQU1FUkEpID09PSBhbmRyb2lkLmNvbnRlbnQucG0uUGFja2FnZU1hbmFnZXIuUEVSTUlTU0lPTl9ERU5JRUQ7XG5cdH1cbn1cblxuZnVuY3Rpb24gc3RhcnRQcmV2aWV3KCkge1xuXG5cdGxldCB0ZXh0dXJlID0gbVRleHR1cmVWaWV3LmdldFN1cmZhY2VUZXh0dXJlKCk7XG5cdGlmICh0ZXh0dXJlID09IG51bGwpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHR0ZXh0dXJlLnNldERlZmF1bHRCdWZmZXJTaXplKG1QcmV2aWV3U2l6ZS5nZXRXaWR0aCgpLCBtUHJldmlld1NpemUuZ2V0SGVpZ2h0KCkpO1xuXHRsZXQgc3VyZmFjZSA9IG5ldyBhbmRyb2lkLnZpZXcuU3VyZmFjZSh0ZXh0dXJlKTtcblxuXHR0cnkge1xuXHRcdG1QcmV2aWV3QnVpbGRlciA9IG1DYW1lcmFEZXZpY2UuY3JlYXRlQ2FwdHVyZVJlcXVlc3QoYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYURldmljZS5URU1QTEFURV9QUkVWSUVXKTtcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHR9XG5cblx0bVByZXZpZXdCdWlsZGVyLmFkZFRhcmdldChzdXJmYWNlKTtcblx0dHJ5IHtcblx0XHRpZiAobVByZXZpZXdTdGF0ZUNhbGxiYWNrID09IG51bGwpIHtcblx0XHRcdG1QcmV2aWV3U3RhdGVDYWxsYmFjayA9IG5ldyBNeVByZXZpZXdTdGF0ZUNhbGxiYWNrKCk7XG5cdFx0fVxuXHRcdGxldCBzdXJmYWNlTGlzdCA9IG5ldyBqYXZhLnV0aWwuQXJyYXlMaXN0KCk7XG5cdFx0c3VyZmFjZUxpc3QuYWRkKHN1cmZhY2UpO1xuXG5cdFx0bUNhbWVyYURldmljZS5jcmVhdGVDYXB0dXJlU2Vzc2lvbihzdXJmYWNlTGlzdCwgbVByZXZpZXdTdGF0ZUNhbGxiYWNrLCBudWxsKTtcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHR9XG59XG5cbi8qIExpc3RlbmVycyAqL1xubGV0IG1TdXJmYWNlVGV4dHVyZUxpc3RlbmVyID0gbmV3IGFuZHJvaWQudmlldy5UZXh0dXJlVmlldy5TdXJmYWNlVGV4dHVyZUxpc3RlbmVyKHtcblx0b25TdXJmYWNlVGV4dHVyZUF2YWlsYWJsZShzdXJmYWNlLCB3aWR0aCwgaGVpZ2h0KSB7XG5cdFx0Y29uc29sZS5sb2coJ1N1cmZhY2VUZXh0dXJlTGlzdGVuZXIgb25TdXJmYWNlVGV4dHVyZUF2YWlsYWJsZScpO1xuXHRcdGxldCBhcHBDb250ZXh0ID0gYXBwbGljYXRpb24uYW5kcm9pZC5mb3JlZ3JvdW5kQWN0aXZpdHk7XG5cdFx0bGV0IG1hbmFnZXIgPSBhcHBDb250ZXh0LmdldFN5c3RlbVNlcnZpY2UoYW5kcm9pZC5jb250ZW50LkNvbnRleHQuQ0FNRVJBX1NFUlZJQ0UpO1xuXHRcdHRyeSB7XG5cdFx0XHRsZXQgY2FtZXJhSWQgPSBtYW5hZ2VyLmdldENhbWVyYUlkTGlzdCgpWzBdOyAvLyBUT0RPOiBmaW5kIHRoZSBiYWNrIGZhY2luZyBjYW1lcmFcblx0XHRcdGxldCBjaGFyYWN0ZXJpc3RpY3MgPSBtYW5hZ2VyLmdldENhbWVyYUNoYXJhY3RlcmlzdGljcyhjYW1lcmFJZCk7XG5cdFx0XHRsZXQgbWFwID0gY2hhcmFjdGVyaXN0aWNzLmdldChhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FtZXJhQ2hhcmFjdGVyaXN0aWNzLlNDQUxFUl9TVFJFQU1fQ09ORklHVVJBVElPTl9NQVApO1xuXHRcdFx0bVByZXZpZXdTaXplID0gbWFwLmdldE91dHB1dFNpemVzKGFuZHJvaWQuZ3JhcGhpY3MuU3VyZmFjZVRleHR1cmUuY2xhc3MpWzBdO1xuXG5cdFx0XHRpZiAobVN0YXRlQ2FsbGJhY2sgPT0gbnVsbCkge1xuXHRcdFx0XHRtU3RhdGVDYWxsYmFjayA9IG5ldyBNeVN0YXRlQ2FsbGJhY2soKTtcblx0XHRcdH1cblxuXHRcdFx0bWFuYWdlci5vcGVuQ2FtZXJhKGNhbWVyYUlkLCBtU3RhdGVDYWxsYmFjaywgbnVsbCk7XG5cdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0fVxuXHR9LFxuXHRvblN1cmZhY2VUZXh0dXJlVXBkYXRlZChzdXJmYWNlKSB7XG5cdFx0Ly8gY29uc29sZS5sb2coJ1N1cmZhY2VUZXh0dXJlTGlzdGVuZXIgb25TdXJmYWNlVGV4dHVyZVVwZGF0ZWQnKTtcblx0fSxcblx0b25TdXJmYWNlVGV4dHVyZVNpemVDaGFuZ2VkKHN1cmZhY2UsIHdpZHRoLCBoZWlnaHQpIHtcblx0XHRjb25zb2xlLmxvZygnU3VyZmFjZVRleHR1cmVMaXN0ZW5lciBvblN1cmZhY2VUZXh0dXJlU2l6ZUNoYW5nZWQnKTtcblx0fSxcblx0b25TdXJmYWNlVGV4dHVyZURlc3Ryb3llZChzdXJmYWNlKSB7XG5cdFx0Y29uc29sZS5sb2coJ1N1cmZhY2VUZXh0dXJlTGlzdGVuZXIgb25TdXJmYWNlVGV4dHVyZURlc3Ryb3llZCcpO1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufSk7XG5cblxuLyogQ2FsbGJhY2tzICovXG5sZXQgTXlTdGF0ZUNhbGxiYWNrID0gYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYURldmljZS5TdGF0ZUNhbGxiYWNrLmV4dGVuZCh7XG5cdG9uT3BlbmVkKGNhbWVyYSkge1xuXHRcdGNvbnNvbGUubG9nKCdDYW1lcmFEZXZpY2UuU3RhdGVDYWxsYmFjayBvbk9wZW5lZCcpO1xuXHRcdG1DYW1lcmFEZXZpY2UgPSBjYW1lcmE7XG5cdFx0c3RhcnRQcmV2aWV3KCk7XG5cdH0sXG5cdG9uRXJyb3IoY2FtZXJhLCBlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoJ0NhbWVyYURldmljZS5TdGF0ZUNhbGxiYWNrRXJyb3I6ICcgKyBlcnJvcik7XG5cdH0sXG5cdG9uRGlzY29ubmVjdGVkKGNhbWVyYSkge1xuXHRcdGNvbnNvbGUubG9nKCdDYW1lcmFEZXZpY2UuU3RhdGVDYWxsYmFjayBvbkRpc2Nvbm5lY3RlZCcpO1xuXHR9XG59KTtcblxubGV0IE15UHJldmlld1N0YXRlQ2FsbGJhY2sgPSBhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FtZXJhQ2FwdHVyZVNlc3Npb24uU3RhdGVDYWxsYmFjay5leHRlbmQoe1xuXHRvbkNvbmZpZ3VyZWQoc2Vzc2lvbikge1xuXHRcdGNvbnNvbGUubG9nKCdDYW1lcmFDYXB0dXJlU2Vzc2lvbi5TdGF0ZUNhbGxiYWNrIG9uQ29uZmlndXJlZCcpO1xuXHRcdGxldCBhcHBDb250ZXh0ID0gYXBwbGljYXRpb24uYW5kcm9pZC5mb3JlZ3JvdW5kQWN0aXZpdHk7XG5cdFx0bVByZXZpZXdTZXNzaW9uID0gc2Vzc2lvbjtcblxuXHRcdG1QcmV2aWV3QnVpbGRlci5zZXQoYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhcHR1cmVSZXF1ZXN0LkNPTlRST0xfTU9ERSxcblx0XHRcdGphdmEubGFuZy5JbnRlZ2VyLnZhbHVlT2YoYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYU1ldGFkYXRhLkNPTlRST0xfTU9ERV9BVVRPKSk7XG5cblx0XHRsZXQgYmFja2dyb3VuZFRocmVhZCA9IG5ldyBhbmRyb2lkLm9zLkhhbmRsZXJUaHJlYWQoJ05OR0NhbWVyYVByZXZpZXcnKTtcblx0XHRiYWNrZ3JvdW5kVGhyZWFkLnN0YXJ0KCk7XG5cdFx0bGV0IGJhY2tncm91bmRIYW5kbGVyID0gbmV3IGFuZHJvaWQub3MuSGFuZGxlcihiYWNrZ3JvdW5kVGhyZWFkLmdldExvb3BlcigpKTtcblxuXHRcdHRyeSB7XG5cdFx0XHRtUHJldmlld1Nlc3Npb24uc2V0UmVwZWF0aW5nUmVxdWVzdChtUHJldmlld0J1aWxkZXIuYnVpbGQoKSwgbnVsbCwgYmFja2dyb3VuZEhhbmRsZXIpO1xuXHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdH1cblx0fSxcblx0b25Db25maWd1cmVGYWlsZWQoc2Vzc2lvbikge1xuXHRcdGNvbnNvbGUubG9nKCdDYW1lcmFDYXB0dXJlU2Vzc2lvbiBDb25maWd1cmUgZmFpbGVkJyk7XG5cdH1cbn0pO1xuXG5cblxuXG4vKiBJTUFHRSBDQVBUVVJFICovXG5mdW5jdGlvbiBjYXB0dXJlSW1hZ2UoKSB7XG5cdGlmIChudWxsID09IG1DYW1lcmFEZXZpY2UpIHtcblx0XHRyZXR1cm47XG5cdH1cblx0bGV0IGFwcENvbnRleHQgPSBhcHBsaWNhdGlvbi5hbmRyb2lkLmZvcmVncm91bmRBY3Rpdml0eTtcblx0bGV0IG1hbmFnZXIgPSBhcHBDb250ZXh0LmdldFN5c3RlbVNlcnZpY2UoYW5kcm9pZC5jb250ZW50LkNvbnRleHQuQ0FNRVJBX1NFUlZJQ0UpO1xuXHR0cnkge1xuXHRcdGxldCBjaGFyYWN0ZXJpc3RpY3MgPSBtYW5hZ2VyLmdldENhbWVyYUNoYXJhY3RlcmlzdGljcyhtQ2FtZXJhRGV2aWNlLmdldElkKCkpO1xuXG5cdFx0bGV0IGpwZWdTaXplczogYW55ID0gbnVsbDtcblx0XHRpZiAoY2hhcmFjdGVyaXN0aWNzICE9IG51bGwpIHtcblx0XHRcdGpwZWdTaXplcyA9IGNoYXJhY3RlcmlzdGljc1xuXHRcdFx0XHQuZ2V0KGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFDaGFyYWN0ZXJpc3RpY3MuU0NBTEVSX1NUUkVBTV9DT05GSUdVUkFUSU9OX01BUClcblx0XHRcdFx0LmdldE91dHB1dFNpemVzKGFuZHJvaWQuZ3JhcGhpY3MuSW1hZ2VGb3JtYXQuSlBFRyk7XG5cdFx0fVxuXHRcdGxldCB3aWR0aCA9IDY0MDsgLy8gZGVmYXVsdFxuXHRcdGxldCBoZWlnaHQgPSA0ODA7IC8vIGRlZmF1bHRcblx0XHRpZiAoanBlZ1NpemVzICE9IG51bGwgJiYganBlZ1NpemVzLmxlbmd0aCA+IDApIHtcblx0XHRcdHdpZHRoID0ganBlZ1NpemVzWzBdLmdldFdpZHRoKCk7XG5cdFx0XHRoZWlnaHQgPSBqcGVnU2l6ZXNbMF0uZ2V0SGVpZ2h0KCk7XG5cdFx0fVxuXG5cdFx0bGV0IHJlYWRlciA9IGFuZHJvaWQubWVkaWEuSW1hZ2VSZWFkZXIubmV3SW5zdGFuY2Uod2lkdGgsIGhlaWdodCwgYW5kcm9pZC5ncmFwaGljcy5JbWFnZUZvcm1hdC5KUEVHLCAxKTtcblx0XHRsZXQgb3V0cHV0U3VyZmFjZXMgPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdCgpO1xuXHRcdG91dHB1dFN1cmZhY2VzLmFkZChyZWFkZXIuZ2V0U3VyZmFjZSgpKTtcblx0XHRvdXRwdXRTdXJmYWNlcy5hZGQobmV3IGFuZHJvaWQudmlldy5TdXJmYWNlKG1UZXh0dXJlVmlldy5nZXRTdXJmYWNlVGV4dHVyZSgpKSk7XG5cblx0XHRsZXQgY2FwdHVyZUJ1aWxkZXIgPSBtQ2FtZXJhRGV2aWNlLmNyZWF0ZUNhcHR1cmVSZXF1ZXN0KGFuZHJvaWQuaGFyZHdhcmUuY2FtZXJhMi5DYW1lcmFEZXZpY2UuVEVNUExBVEVfU1RJTExfQ0FQVFVSRSk7XG5cdFx0Y2FwdHVyZUJ1aWxkZXIuYWRkVGFyZ2V0KHJlYWRlci5nZXRTdXJmYWNlKCkpO1xuXHRcdGNhcHR1cmVCdWlsZGVyLnNldChhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FwdHVyZVJlcXVlc3QuQ09OVFJPTF9NT0RFLFxuXHRcdFx0amF2YS5sYW5nLkludGVnZXIudmFsdWVPZihhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FtZXJhTWV0YWRhdGEuQ09OVFJPTF9NT0RFX0FVVE8pKTtcblxuXHRcdC8vIFRPRE86IHJvdGF0aW9uXG5cdFx0bGV0IHJvdGF0aW9uID0gYXBwQ29udGV4dC5nZXRXaW5kb3dNYW5hZ2VyKCkuZ2V0RGVmYXVsdERpc3BsYXkoKS5nZXRSb3RhdGlvbigpO1xuXHRcdGNhcHR1cmVCdWlsZGVyLnNldChhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FwdHVyZVJlcXVlc3QuSlBFR19PUklFTlRBVElPTiwgamF2YS5sYW5nLkludGVnZXIudmFsdWVPZihnZXRSb3RhdGlvbihyb3RhdGlvbikpKTtcblxuXHRcdGxldCBmaWxlID0gbmV3IGphdmEuaW8uRmlsZShhbmRyb2lkLm9zLkVudmlyb25tZW50LmdldEV4dGVybmFsU3RvcmFnZURpcmVjdG9yeSgpICsgXCIvRENJTVwiLCBcInBpYy5qcGdcIik7XG5cdFx0bGV0IHJlYWRlckxpc3RlbmVyID0gbmV3IGFuZHJvaWQubWVkaWEuSW1hZ2VSZWFkZXIuT25JbWFnZUF2YWlsYWJsZUxpc3RlbmVyKHtcblx0XHRcdHNhdmUoYnl0ZXMpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ1NhdmluZyBCeXRlcycpO1xuXHRcdFx0XHRsZXQgb3V0cHV0ID0gbnVsbDtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRvdXRwdXQgPSBuZXcgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtKGZpbGUpO1xuXHRcdFx0XHRcdG91dHB1dC53cml0ZShieXRlcyk7XG5cdFx0XHRcdH0gZmluYWxseSB7XG5cdFx0XHRcdFx0aWYgKG91dHB1dCAhPSBudWxsKSB7XG5cdFx0XHRcdFx0XHRvdXRwdXQuY2xvc2UoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRvbkltYWdlQXZhaWxhYmxlKHJlYWRlcikge1xuXHRcdFx0XHRsZXQgaW1hZ2UgPSBudWxsO1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGltYWdlID0gcmVhZGVyLmFjcXVpcmVMYXRlc3RJbWFnZSgpO1xuXHRcdFx0XHRcdGxldCBidWZmZXIgPSBpbWFnZS5nZXRQbGFuZXMoKVswXS5nZXRCdWZmZXIoKTtcblx0XHRcdFx0XHQvLyBjb25zdCBieXRlcyA9IG5ldyBqYXZhLmxhbmcuQnl0ZVtidWZmZXIuY2FwYWNpdHkoKV07XG5cdFx0XHRcdFx0bGV0IGJ5dGVzID0gQXJyYXkuY3JlYXRlKCdieXRlJywgYnVmZmVyLmNhcGFjaXR5KCkpO1xuXHRcdFx0XHRcdGJ1ZmZlci5nZXQoYnl0ZXMpO1xuXHRcdFx0XHRcdHRoaXMuc2F2ZShieXRlcyk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0XHRcdFx0fSBmaW5hbGx5IHtcblx0XHRcdFx0XHRpZiAoaW1hZ2UgIT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0aW1hZ2UuY2xvc2UoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGxldCB0aHJlYWQgPSBuZXcgYW5kcm9pZC5vcy5IYW5kbGVyVGhyZWFkKCdOTkdDYW1lcmFQcmV2aWV3Jyk7XG5cdFx0dGhyZWFkLnN0YXJ0KCk7XG5cdFx0bGV0IGJhY2tncm91bmRIYW5kbGVyID0gbmV3IGFuZHJvaWQub3MuSGFuZGxlcih0aHJlYWQuZ2V0TG9vcGVyKCkpO1xuXHRcdHJlYWRlci5zZXRPbkltYWdlQXZhaWxhYmxlTGlzdGVuZXIocmVhZGVyTGlzdGVuZXIsIGJhY2tncm91bmRIYW5kbGVyKTtcblxuXHRcdGxldCBjYXB0dXJlTGlzdGVuZXIgPSBhbmRyb2lkLmhhcmR3YXJlLmNhbWVyYTIuQ2FtZXJhQ2FwdHVyZVNlc3Npb24uQ2FwdHVyZUNhbGxiYWNrLmV4dGVuZCh7XG5cdFx0XHRvbkNhcHR1cmVDb21wbGV0ZWQoc2Vzc2lvbiwgcmVxdWVzdCwgcmVzdWx0KSB7XG5cdFx0XHRcdHN0YXJ0UHJldmlldygpO1xuXHRcdFx0XHRjb25zb2xlLmxvZygnQ2FwdHVyZSBDb21wbGV0ZScpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0bGV0IGNhcHR1cmVTdGF0ZUNhbGxiYWNrID0gYW5kcm9pZC5oYXJkd2FyZS5jYW1lcmEyLkNhbWVyYUNhcHR1cmVTZXNzaW9uLlN0YXRlQ2FsbGJhY2suZXh0ZW5kKHtcblx0XHRcdG9uQ29uZmlndXJlZChzZXNzaW9uKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0c2Vzc2lvbi5jYXB0dXJlKGNhcHR1cmVCdWlsZGVyLmJ1aWxkKCksIG5ldyBjYXB0dXJlTGlzdGVuZXIoKSwgYmFja2dyb3VuZEhhbmRsZXIpO1xuXHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRvbkNvbmZpZ3VyZUZhaWxlZChzZXNzaW9uKSB7XG5cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdG1DYW1lcmFEZXZpY2UuY3JlYXRlQ2FwdHVyZVNlc3Npb24ob3V0cHV0U3VyZmFjZXMsIG5ldyBjYXB0dXJlU3RhdGVDYWxsYmFjaygpLCBiYWNrZ3JvdW5kSGFuZGxlcik7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0fVxufVxuXG5mdW5jdGlvbiBnZXRSb3RhdGlvbihyb3RhdGlvbikge1xuXHRpZiAocm90YXRpb24gPT09IGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzApIHtcblx0XHRyZXR1cm4gOTA7XG5cdH0gZWxzZSBpZiAocm90YXRpb24gPT09IGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzkwKSB7XG5cdFx0cmV0dXJuIDA7XG5cdH0gZWxzZSBpZiAocm90YXRpb24gPT09IGFuZHJvaWQudmlldy5TdXJmYWNlLlJPVEFUSU9OXzE4MCkge1xuXHRcdHJldHVybiAyNzA7XG5cdH0gZWxzZSB7XG5cdFx0cmV0dXJuIDE4MDtcblx0fVxufSJdfQ==